generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int               @id @default(autoincrement()) @map("id_User")
  role             String            @unique @map("Role")
  passwordHash     String            @map("Password")
  email            String?           @unique @map("Email")
  name             String?           @map("Name")
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  dormRecords      DormRecord[]      @relation("UserDormRecords")
  electricityBills ElectricityBill[] @relation("UserBills")
  sessions         Session[]         @relation("UserSessions")

  @@map("User")
}

model Session {
  id           String   @id @default(cuid())
  userId       Int
  refreshToken String   @unique
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  user         User     @relation("UserSessions", fields: [userId], references: [id], onDelete: Cascade)
}

model Panel {
  id               Int               @id @default(autoincrement()) @map("id_Panel")
  namePanel        String            @unique @map("Name_Panel")
  category         PanelCategory     @default(FACILITY_MANAGEMENT)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  electricityBills ElectricityBill[] @relation("PanelBills")

  @@map("Panel")
}

model ElectricityBill {
  id           Int      @id @default(autoincrement()) @map("id_Bills")
  panelId      Int      @map("id_Panel")
  userId       Int      @map("id_User")
  billingMonth DateTime @map("Billing_month")
  kwhUse       Decimal  @map("kwh_use") @db.Decimal(10, 2)
  vaStatus     String?  @map("VA_status")
  totalBills   Decimal  @map("Total_Bills") @db.Decimal(10, 2)
  statusPay    String   @default("Belum Lunas") @map("Status_Pay")
  createdAt    DateTime @default(now()) @map("Created_at")
  panel        Panel    @relation("PanelBills", fields: [panelId], references: [id], onDelete: Cascade)
  user         User     @relation("UserBills", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([panelId, billingMonth], name: "unique_panel_month")
  @@index([panelId])
  @@index([userId])
  @@index([billingMonth])
  @@map("Electricity_Bills")
}

model DormRecord {
  id         String   @id @default(cuid())
  period     DateTime
  dormName   String
  totalKwh   Float
  billAmount Float
  createdBy  Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation("UserDormRecords", fields: [createdBy], references: [id])

  @@map("DormRecord")
}

model Dorm {
  id            String   @id @default(cuid())
  name          String   @unique
  gender        Gender
  powerCapacity Int
  capacity      Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

enum Gender {
  PUTRA
  PUTRI
  CAMPUR
}

enum PanelCategory {
  FACILITY_MANAGEMENT
  STUDENT_HOUSING
}
